<%- include('../admin/adminLayout/header.ejs')%>


<!-- saideNaveBar -->
<style>
  .custom-confirm-button {
    margin-right: 50px; 
}

.custom-cancel-button {
    margin-left: 50px; 
}
</style>


<!-- saideNaveBar -->

<body class="g-sidenav-show  bg-gray-200">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark" id="sidenav-main">
    <div class="sidenav-header" style="margin: 15px;">
      <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href="#" target="_blank"></a>
        <img src="/assets/img/my_Logo.png" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold text-white">Energy Cart</span>
      </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto  max-height-vh-100" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/admin/adminHome">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">dashboard</i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white active bg-gradient-primary" href="/admin/view-users">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">group</i>
            </div>
            <span class="nav-link-text ms-1">Users</span>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link text-white" href="/admin/view-banner">
              <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">add_photo_alternate</i>
              </div>
              <span class="nav-link-text ms-1">Banner</span>
            </a>
          </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/view-product">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">inventory_2</i>
            </div>
            <span class="nav-link-text ms-1">Product</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link text-white" href="/admin/view-brand">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">branding_watermark</i>
            </div> 
            <span class="nav-link-text ms-1">Brand</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/view-category">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">category</i>
            </div>
            <span class="nav-link-text ms-1">Category</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="/admin/">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">local_offer</i>
            </div>
            <span class="nav-link-text ms-1">Offers</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/view-orders">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">wysiwyg</i>
            </div>
            <span class="nav-link-text ms-1">Orders</span>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link text-white " href="/admin/view-coupon">
              <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">redeem</i>
              </div>
              <span class="nav-link-text ms-1">Coupon</span>
            </a>
          </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-white font-weight-bolder opacity-8">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="./pages/profile.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">person</i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/logout">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">logout</i>
            </div>
            <span class="nav-link-text ms-1">Log out</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="./pages/sign-up.html">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">assignment</i>
            </div>
            <span class="nav-link-text ms-1">Sign Up</span>
          </a>
        </li>
      </ul>
    </div>
    <!-- <div class="sidenav-footer position-absolute w-100 bottom-0 ">
      <div class="mx-3">
        <a class="btn bg-gradient-primary mt-4 w-100" href="https://www.creative-tim.com/product/material-dashboard-pro?ref=sidebarfree" type="button">Upgrade to pro</a>
      </div>
    </div> -->
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    
    <%- include('../admin/adminLayout/navbar.ejs')%>
<!-- endSaidNavBar -->


<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="card my-4">
        <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
          <div
            class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3"
          >
            <h6 class="text-white text-capitalize ps-3"><%=title%></h6>
          </div>
        </div>
        <div class="card-body px-0 pb-2">
          <div class="table-responsive p-0">
            <table class="table align-items-center mb-4">
              <thead>
                <tr style="background-color: rgb(227, 225, 225);">
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    No
                  </th>
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    User Name
                  </th>
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    Email
                  </th>
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    Mobile
                  </th>
                  <!-- <th class="text-uppercase text-xxs font-weight-bolder  ps-2" style="color: black;">Image</th> -->
                  <!-- <th class="text-uppercase text-secondary text-xxs font-weight-bolder  ps-2">Update</th> -->
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    Status
                  </th>
                  <th
                    class="text-uppercase text-xxs font-weight-bolder ps-2"
                    style="color: black;"
                  >
                    Action
                  </th>
                </tr>
              </thead>
              <tbody>
                <% let counter = 1; %> 
                <% userData.forEach(user=>{%> <% if
                (user.is_admin === 0) { %>
                <tr>
                  <td>
                    <p class="text-xs font-weight-bold mb-0"><%= counter %></p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0"><%=user.name%></p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0"><%=user.email%></p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0"><%=user.mobile%></p>
                  </td>
                  <!-- <td>
                    <img src="/userImages/<%=user.image %>" class="avatar avatar-sm me-3 border-radius-lg" alt="">
                  </td> -->

                  <!-- Verified/Not Verified -->
                  <% if(user.is_varified==0){%>
                  <td>
                    <p class="text-xs text-danger font-weight-bold mb-0">
                      Not Verified
                    </p>
                  </td>
                  <%}else{%>
                  <td>
                    <p class="text-xs text-success font-weight-bold mb-0">
                      Verified
                    </p>
                  </td>
                  <%}%>

                  <!-- User Active/Blocked -->
                  <% if(user.is_block===true){%>
                  <td class="text-sm">
                    <a href="/admin/is_blockedUser?id=<%= user._id %>" class="block-unblock-link">
                      <span class="badge badge-sm bg-gradient-danger">Blocked</span></a>
                  </td>

                  <% }else{ %>

                  <td class="text-sm">
                    <a href="/admin/is_blockedUser?id=<%= user._id %>" class="block-unblock-link">
                      <span class="badge badge-sm bg-gradient-success">Active</span></a>
                  </td>
                  <% } %> 
                  <% counter++; %>
                  <% } %> 
                  <%});%> 
                </tr>
              </tbody>
            </table>
          </div>

          <div class="row">
            <div class="col-md-12 d-flex justify-content-center">
              <!-- pagination -->
          <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="?page=<%= Math.max(currentPage - 1, 0) %>">Previous</a>
            </li>
            <% for (let i = 1; i <= totalPages; i++) { %>
                <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                    <a class="page-link" href="?page=<%= i - 1 %>"><%= i %></a>
                </li>
            <% } %>
            <li class="page-item">
                <a class="page-link" href="?page=<%= Math.min(currentPage + 1, totalPages - 1) %>">Next</a>
            </li>
        </ul>
         <!-- end pagination -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let blockUnblockList = document.querySelectorAll(".block-unblock-link");

    for (let i = 0; i < blockUnblockList.length; i++) {
      blockUnblockList[i].addEventListener("click", function (event) {
        event.preventDefault();

        let link = this;
        let userId = link.href.split("=")[1]; // Extracting user ID from the link

        const successAlert = Swal.mixin({
          customClass: {
            confirmButton: "btn btn-success",
            cancelButton: "btn btn-danger",
            actions: "my-custom-class", // Add a custom class for styling
          },
          buttonsStyling: false,
        });
        successAlert.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Block/Active!",
          cancelButtonText: "No, cancel!",
          reverseButtons: true,
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = link.href;

            successAlert.fire({
              title: "Blocked!",
              text: "User has been blocked.",
              icon: "success",
            });
          } else if (result.dismiss === Swal.DismissReason.cancel) {
            successAlert.fire({
              title: "Cancelled",
              text: "Your action is Cancelled:",
              icon: "error",
            });
          }
        });
      });
    }
  });
</script>

<style>
  /* Add some padding to the buttons */
  .my-custom-class .swal2-confirm,
  .my-custom-class .swal2-cancel {
    padding: 10px 20px;
    margin: 5px;
  }
</style>


<%-include('../admin/adminLayout/footer.ejs')%>
